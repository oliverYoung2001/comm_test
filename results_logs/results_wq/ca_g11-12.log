make -C csrc clean
make[1]: Entering directory `/public/home/qinghuatest/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
ls: cannot access *.o: No such file or directory
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory `/public/home/qinghuatest/yhy/llm/comm_test/csrc'
make -C csrc conflict_allinone
make[1]: Entering directory `/public/home/qinghuatest/yhy/llm/comm_test/csrc'
nvcc conflict_allinone.cu -std=c++11 -Xcompiler -fopenmp -I/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/include -L/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o conflict_allinone.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/include -L/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/include -L/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" conflict_allinone.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/lib -L/public/home/qinghuatest/yhy/.local/spack/opt/spack/linux-centos7-cascadelake/gcc-13.2.0/cuda-11.8.0-rvlajpvy3ynvqmhgwhm5dnhe56gyitdq/bin/../lib64 -lcudart -lnccl -Wall -o build/conflict_allinone -Wl,-rpath=/public/home/qinghuatest/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o utils.o conflict_allinone.o
make[1]: Leaving directory `/public/home/qinghuatest/yhy/llm/comm_test/csrc'
BACKEND: NCCL
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /public/home/qinghuatest/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /public/home/qinghuatest/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG=WARN -x NCCL_NET_GDR_LEVEL=5 -x NCCL_DEBUG_SUBSYS=NET -x NCCL_IB_DISABLE=0 -np 16 --host gpu11:8,gpu12:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone 16 NCCL ./scripts/configs/small_16.json
[gpu12:22081] MCW rank 8 bound to socket 0[core 0[hwt 0]]: [B/././././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 0 bound to socket 0[core 0[hwt 0]]: [B/././././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 9 bound to socket 0[core 1[hwt 0]]: [./B/./././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 1 bound to socket 0[core 1[hwt 0]]: [./B/./././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 10 bound to socket 0[core 2[hwt 0]]: [././B/././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 2 bound to socket 0[core 2[hwt 0]]: [././B/././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 11 bound to socket 0[core 3[hwt 0]]: [./././B/./././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 3 bound to socket 0[core 3[hwt 0]]: [./././B/./././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 12 bound to socket 1[core 32[hwt 0]]: [./././././././././././././././././././././././././././././././.][B/././././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 4 bound to socket 1[core 32[hwt 0]]: [./././././././././././././././././././././././././././././././.][B/././././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 13 bound to socket 1[core 33[hwt 0]]: [./././././././././././././././././././././././././././././././.][./B/./././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 5 bound to socket 1[core 33[hwt 0]]: [./././././././././././././././././././././././././././././././.][./B/./././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 14 bound to socket 1[core 34[hwt 0]]: [./././././././././././././././././././././././././././././././.][././B/././././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 6 bound to socket 1[core 34[hwt 0]]: [./././././././././././././././././././././././././././././././.][././B/././././././././././././././././././././././././././././.]
[gpu12:22081] MCW rank 15 bound to socket 1[core 35[hwt 0]]: [./././././././././././././././././././././././././././././././.][./././B/./././././././././././././././././././././././././././.]
[gpu11:20295] MCW rank 7 bound to socket 1[core 35[hwt 0]]: [./././././././././././././././././././././././././././././././.][./././B/./././././././././././././././././././././././././././.]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   gpu11
  Local device: mlx5_2
--------------------------------------------------------------------------
NCCL version 2.18.5+cuda11.8
[[0,1]]
[admin1:15032] 15 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[admin1:15032] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
time 0.069455 s, REAL_BD 21.596717 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.277588 s, REAL_BD 21.614767 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,1],[1,0]]
time 0.071120 s, REAL_BD 42.182227 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.283849 s, REAL_BD 42.275999 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8]]
time 0.189232 s, REAL_BD 7.926778 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.819545 s, REAL_BD 7.321136 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,8],[8,0]]
time 0.400344 s, REAL_BD 7.493556 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 1.532193 s, REAL_BD 7.831912 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,15],[15,0]]
time 0.812796 s, REAL_BD 3.690963 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 3.416080 s, REAL_BD 3.512798 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[0,15]]
time 0.531482 s, REAL_BD 5.644594 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 1.953245 s, REAL_BD 6.143623 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[0,15],[8,0],[15,0]]
time 1.744438 s, REAL_BD 3.439503 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 6.144508 s, REAL_BD 3.905927 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[7,8],[15,0]]
time 0.277163 s, REAL_BD 10.823956 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 1.314997 s, REAL_BD 9.125496 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[2,10]]
time 0.793367 s, REAL_BD 3.781352 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 1.916049 s, REAL_BD 6.262888 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[8,0],[2,10],[10,2]]
time 1.000548 s, REAL_BD 5.996714 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 3.485914 s, REAL_BD 6.884851 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[4,12]]
time 0.346590 s, REAL_BD 8.655760 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 1.110456 s, REAL_BD 10.806371 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[8,0],[4,12],[12,4]]
time 0.503790 s, REAL_BD 11.909724 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 1.865612 s, REAL_BD 12.864411 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[2,10],[4,12],[6,14]]
time 0.735751 s, REAL_BD 8.154933 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 2.781825 s, REAL_BD 8.627430 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[8,0],[2,10],[10,2],[4,12],[12,4],[6,14],[14,6]]
time 1.119544 s, REAL_BD 10.718650 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 5.228335 s, REAL_BD 9.180743 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15]]
time 1.303791 s, REAL_BD 9.203929 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 4.295433 s, REAL_BD 11.174659 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15],[8,0],[9,1],[10,2],[11,3],[12,4],[13,5],[14,6],[15,7]]
time 1.550615 s, REAL_BD 15.477730 GB/s, SIZE 524288.000000 KB, comm_vol 25165824.000000 KB
time 7.390575 s, REAL_BD 12.989517 GB/s, SIZE 2097152.000000 KB, comm_vol 100663296.000000 KB
+ set +x
BACKEND: MPI
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /public/home/qinghuatest/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /public/home/qinghuatest/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG=WARN -x NCCL_NET_GDR_LEVEL=5 -x NCCL_DEBUG_SUBSYS=NET -x NCCL_IB_DISABLE=0 -np 16 --host gpu11:8,gpu12:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone 16 MPI ./scripts/configs/small_16.json
[gpu12:26772] MCW rank 8 bound to socket 0[core 0[hwt 0]]: [B/././././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 9 bound to socket 0[core 1[hwt 0]]: [./B/./././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 10 bound to socket 0[core 2[hwt 0]]: [././B/././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 11 bound to socket 0[core 3[hwt 0]]: [./././B/./././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 12 bound to socket 1[core 32[hwt 0]]: [./././././././././././././././././././././././././././././././.][B/././././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 13 bound to socket 1[core 33[hwt 0]]: [./././././././././././././././././././././././././././././././.][./B/./././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 14 bound to socket 1[core 34[hwt 0]]: [./././././././././././././././././././././././././././././././.][././B/././././././././././././././././././././././././././././.]
[gpu12:26772] MCW rank 15 bound to socket 1[core 35[hwt 0]]: [./././././././././././././././././././././././././././././././.][./././B/./././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 0 bound to socket 0[core 0[hwt 0]]: [B/././././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 1 bound to socket 0[core 1[hwt 0]]: [./B/./././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 2 bound to socket 0[core 2[hwt 0]]: [././B/././././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 3 bound to socket 0[core 3[hwt 0]]: [./././B/./././././././././././././././././././././././././././.][./././././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 4 bound to socket 1[core 32[hwt 0]]: [./././././././././././././././././././././././././././././././.][B/././././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 5 bound to socket 1[core 33[hwt 0]]: [./././././././././././././././././././././././././././././././.][./B/./././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 6 bound to socket 1[core 34[hwt 0]]: [./././././././././././././././././././././././././././././././.][././B/././././././././././././././././././././././././././././.]
[gpu11:25795] MCW rank 7 bound to socket 1[core 35[hwt 0]]: [./././././././././././././././././././././././././././././././.][./././B/./././././././././././././././././././././././././././.]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   gpu11
  Local device: mlx5_2
--------------------------------------------------------------------------
[[0,1]]
NCCL version 2.18.5+cuda11.8
time 0.063878 s, REAL_BD 23.482263 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.255297 s, REAL_BD 23.502039 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,1],[1,0]]
time 0.063897 s, REAL_BD 46.950561 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
[admin1:02015] 15 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[admin1:02015] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
time 0.255392 s, REAL_BD 46.986593 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8]]
time 0.077407 s, REAL_BD 19.378092 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.510770 s, REAL_BD 11.746970 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,8],[8,0]]
time 0.227719 s, REAL_BD 13.174131 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.941161 s, REAL_BD 12.750210 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,15],[15,0]]
time 0.204342 s, REAL_BD 14.681270 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.910710 s, REAL_BD 13.176533 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[0,15]]
time 0.143017 s, REAL_BD 20.976527 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.990091 s, REAL_BD 12.120098 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[0,15],[8,0],[15,0]]
time 0.342741 s, REAL_BD 17.505930 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 1.669716 s, REAL_BD 14.373702 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[7,8],[15,0]]
time 0.195696 s, REAL_BD 15.329899 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.833355 s, REAL_BD 14.399626 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[2,10]]
time 0.276789 s, REAL_BD 10.838581 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 1.035362 s, REAL_BD 11.590149 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[8,0],[2,10],[10,2]]
time 0.386792 s, REAL_BD 15.512213 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 1.744066 s, REAL_BD 13.760947 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[4,12]]
time 0.135243 s, REAL_BD 22.182294 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.722906 s, REAL_BD 16.599669 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[8,0],[4,12],[12,4]]
time 0.307312 s, REAL_BD 19.524132 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 1.250360 s, REAL_BD 19.194472 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[2,10],[4,12],[6,14]]
time 0.359390 s, REAL_BD 16.694955 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 1.385595 s, REAL_BD 17.321079 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[8,0],[2,10],[10,2],[4,12],[12,4],[6,14],[14,6]]
time 0.527244 s, REAL_BD 22.759861 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 2.320983 s, REAL_BD 20.680893 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15]]
time 0.793196 s, REAL_BD 15.128669 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 3.010559 s, REAL_BD 15.943883 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15],[8,0],[9,1],[10,2],[11,3],[12,4],[13,5],[14,6],[15,7]]
time 1.010944 s, REAL_BD 23.740187 GB/s, SIZE 524288.000000 KB, comm_vol 25165824.000000 KB
time 4.623648 s, REAL_BD 20.762826 GB/s, SIZE 2097152.000000 KB, comm_vol 100663296.000000 KB
+ set +x
