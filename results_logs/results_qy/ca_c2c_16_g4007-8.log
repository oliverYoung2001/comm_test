make -C csrc clean
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
ls: cannot access '*.o': No such file or directory
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
make -C csrc conflict_allinone_c2c
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
nvcc conflict_allinone_c2c.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o conflict_allinone_c2c.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" conflict_allinone_c2c.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib -L/data/apps/tools/spack/opt/spack/linux-ubuntu20.04-icelake/gcc-9.4.0/cuda-11.8.0-rqw2h4odyk5x2hyrawxblsmj5yxmka6e/bin/../lib64 -lcudart -lnccl -Wall -o build/conflict_allinone_c2c -Wl,-rpath=/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o conflict_allinone_c2c.o utils.o
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
BACKEND: MPI
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG=WARN -np 16 --host g4007:8,g4008:8 ./csrc/build/conflict_allinone_c2c 16 MPI ./scripts/configs/small_16.json
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g4008
  Local device: mlx5_0
--------------------------------------------------------------------------
[[0,1]]
time 0.000562 s, REAL_BD 5.212967 GB/s, SIZE 1024.000000 KB, comm_vol 3072.000000 KB
time 0.080647 s, REAL_BD 4.649894 GB/s, SIZE 131072.000000 KB, comm_vol 393216.000000 KB
time 0.315737 s, REAL_BD 4.750789 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
[mngg001:84423] 15 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:84423] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
time 33.465039 s, REAL_BD 0.179292 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,1],[1,0]]
time 0.000762 s, REAL_BD 7.689469 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.085725 s, REAL_BD 8.748906 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.324674 s, REAL_BD 9.240038 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 4.232822 s, REAL_BD 2.834988 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8]]
time 0.000214 s, REAL_BD 13.690129 GB/s, SIZE 1024.000000 KB, comm_vol 3072.000000 KB
time 0.008191 s, REAL_BD 45.781956 GB/s, SIZE 131072.000000 KB, comm_vol 393216.000000 KB
time 0.032697 s, REAL_BD 45.875768 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.130757 s, REAL_BD 45.886645 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,8],[8,0]]
time 0.000125 s, REAL_BD 46.875000 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.008217 s, REAL_BD 91.274188 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.032786 s, REAL_BD 91.502471 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.181749 s, REAL_BD 66.025123 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,15],[15,0]]
time 0.000140 s, REAL_BD 41.852679 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.008215 s, REAL_BD 91.296409 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.032775 s, REAL_BD 91.533181 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.224323 s, REAL_BD 53.494292 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[0,15]]
time 0.000166 s, REAL_BD 35.297440 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.016346 s, REAL_BD 45.882785 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.065316 s, REAL_BD 45.930553 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.261019 s, REAL_BD 45.973665 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[0,15],[8,0],[15,0]]
time 0.000207 s, REAL_BD 56.612319 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.018951 s, REAL_BD 79.151496 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.065395 s, REAL_BD 91.750134 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.282427 s, REAL_BD 84.977711 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[7,8],[15,0]]
time 0.000104 s, REAL_BD 56.340144 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.008207 s, REAL_BD 91.385403 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.032722 s, REAL_BD 91.681438 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.181024 s, REAL_BD 66.289553 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[2,10]]
time 0.000163 s, REAL_BD 35.947086 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.016346 s, REAL_BD 45.882785 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.065266 s, REAL_BD 45.965740 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.267449 s, REAL_BD 44.868367 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[8,0],[2,10],[10,2]]
time 0.000252 s, REAL_BD 46.502976 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.016776 s, REAL_BD 89.413448 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.065488 s, REAL_BD 91.619839 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.337227 s, REAL_BD 71.168679 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[4,12]]
time 0.000177 s, REAL_BD 33.103814 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.016349 s, REAL_BD 45.874365 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.065272 s, REAL_BD 45.961515 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.265108 s, REAL_BD 45.264571 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[[0,8],[8,0],[4,12],[12,4]]
time 0.000240 s, REAL_BD 48.828125 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.016384 s, REAL_BD 91.552734 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.065443 s, REAL_BD 91.682839 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.336357 s, REAL_BD 71.352759 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[2,10],[4,12],[6,14]]
time 0.000301 s, REAL_BD 38.932724 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.032652 s, REAL_BD 45.938993 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.130496 s, REAL_BD 45.978421 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.522026 s, REAL_BD 45.974722 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[[0,8],[8,0],[2,10],[10,2],[4,12],[12,4],[6,14],[14,6]]
time 0.000336 s, REAL_BD 69.754464 GB/s, SIZE 1024.000000 KB, comm_vol 24576.000000 KB
time 0.032731 s, REAL_BD 91.656228 GB/s, SIZE 131072.000000 KB, comm_vol 3145728.000000 KB
time 0.130792 s, REAL_BD 91.748731 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 0.539683 s, REAL_BD 88.941101 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15]]
time 0.000552 s, REAL_BD 42.459239 GB/s, SIZE 1024.000000 KB, comm_vol 24576.000000 KB
time 0.065268 s, REAL_BD 45.964332 GB/s, SIZE 131072.000000 KB, comm_vol 3145728.000000 KB
time 0.260942 s, REAL_BD 45.987231 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 1.044617 s, REAL_BD 45.949855 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15],[8,0],[9,1],[10,2],[11,3],[12,4],[13,5],[14,6],[15,7]]
time 0.000573 s, REAL_BD 81.806283 GB/s, SIZE 1024.000000 KB, comm_vol 49152.000000 KB
time 0.066899 s, REAL_BD 89.687439 GB/s, SIZE 131072.000000 KB, comm_vol 6291456.000000 KB
time 0.268262 s, REAL_BD 89.464777 GB/s, SIZE 524288.000000 KB, comm_vol 25165824.000000 KB
time 1.090642 s, REAL_BD 88.021551 GB/s, SIZE 2097152.000000 KB, comm_vol 100663296.000000 KB
