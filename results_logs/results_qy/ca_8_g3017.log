make -C csrc clean
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
ls: cannot access '*.o': No such file or directory
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
make -C csrc conflict_allinone
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
nvcc conflict_allinone.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o conflict_allinone.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" conflict_allinone.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib -L/home/zhaijidong/yhy/.local/cuda-11.8/bin/../lib64 -lcudart -lnccl -Wall -o build/conflict_allinone -Wl,-rpath=/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o utils.o conflict_allinone.o
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
BACKEND: NCCL
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG -x NCCL_NET_GDR_LEVEL -x NCCL_DEBUG_SUBSYS -x NCCL_IB_DISABLE -np 8 --host g3017:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone 8 NCCL ./scripts/configs/small_8.json
[g3017:1681857] MCW rank 0 bound to socket 0[core 0[hwt 0-1]]: [BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 1 bound to socket 0[core 1[hwt 0-1]]: [../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 2 bound to socket 0[core 2[hwt 0-1]]: [../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 3 bound to socket 0[core 3[hwt 0-1]]: [../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 4 bound to socket 1[core 32[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 5 bound to socket 1[core 33[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 6 bound to socket 1[core 34[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1681857] MCW rank 7 bound to socket 1[core 35[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g3017
  Local device: mlx5_0
--------------------------------------------------------------------------
NCCL version 2.21.5+cuda11.8
[dmx-login03:166072] 7 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[dmx-login03:166072] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
[[0,1]]
time 0.001327 s, REAL_BD 117.746797 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.003461 s, REAL_BD 180.583646 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.011498 s, REAL_BD 217.429118 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.043271 s, REAL_BD 231.101662 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[0,1],[1,0]]
time 0.001517 s, REAL_BD 205.998682 GB/s, SIZE 16384.000000 KB, comm_vol 327680.000000 KB
time 0.004135 s, REAL_BD 302.297461 GB/s, SIZE 65536.000000 KB, comm_vol 1310720.000000 KB
time 0.014378 s, REAL_BD 347.753512 GB/s, SIZE 262144.000000 KB, comm_vol 5242880.000000 KB
time 0.047602 s, REAL_BD 420.150414 GB/s, SIZE 1048576.000000 KB, comm_vol 20971520.000000 KB
[[0,2]]
time 0.001245 s, REAL_BD 125.502008 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.003367 s, REAL_BD 185.625186 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.011263 s, REAL_BD 221.965728 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.042440 s, REAL_BD 235.626767 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[0,2],[2,0]]
time 0.001449 s, REAL_BD 215.665977 GB/s, SIZE 16384.000000 KB, comm_vol 327680.000000 KB
time 0.004108 s, REAL_BD 304.284323 GB/s, SIZE 65536.000000 KB, comm_vol 1310720.000000 KB
time 0.014246 s, REAL_BD 350.975712 GB/s, SIZE 262144.000000 KB, comm_vol 5242880.000000 KB
time 0.047312 s, REAL_BD 422.725736 GB/s, SIZE 1048576.000000 KB, comm_vol 20971520.000000 KB
[[0,4]]
time 0.001276 s, REAL_BD 122.452978 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.003377 s, REAL_BD 185.075511 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.011270 s, REAL_BD 221.827862 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.042388 s, REAL_BD 235.915825 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[4,6]]
NCCL version 2.21.5+cuda11.8
time 0.001225 s, REAL_BD 127.551020 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.003349 s, REAL_BD 186.622872 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.011467 s, REAL_BD 218.016918 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.042775 s, REAL_BD 233.781414 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[0,1],[1,2],[2,0]]
time 0.002073 s, REAL_BD 226.121563 GB/s, SIZE 16384.000000 KB, comm_vol 491520.000000 KB
time 0.007203 s, REAL_BD 260.308205 GB/s, SIZE 65536.000000 KB, comm_vol 1966080.000000 KB
time 0.015988 s, REAL_BD 469.101826 GB/s, SIZE 262144.000000 KB, comm_vol 7864320.000000 KB
time 0.049139 s, REAL_BD 610.513034 GB/s, SIZE 1048576.000000 KB, comm_vol 31457280.000000 KB
[[0,1],[1,2],[2,3],[3,0]]
time 0.002156 s, REAL_BD 289.888683 GB/s, SIZE 16384.000000 KB, comm_vol 655360.000000 KB
time 0.007400 s, REAL_BD 337.837838 GB/s, SIZE 65536.000000 KB, comm_vol 2621440.000000 KB
time 0.016034 s, REAL_BD 623.674691 GB/s, SIZE 262144.000000 KB, comm_vol 10485760.000000 KB
time 0.049486 s, REAL_BD 808.309421 GB/s, SIZE 1048576.000000 KB, comm_vol 41943040.000000 KB
[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]]
time 0.003771 s, REAL_BD 248.607796 GB/s, SIZE 16384.000000 KB, comm_vol 983040.000000 KB
time 0.013923 s, REAL_BD 269.338505 GB/s, SIZE 65536.000000 KB, comm_vol 3932160.000000 KB
time 0.017354 s, REAL_BD 864.354039 GB/s, SIZE 262144.000000 KB, comm_vol 15728640.000000 KB
time 0.050921 s, REAL_BD 1178.295792 GB/s, SIZE 1048576.000000 KB, comm_vol 62914560.000000 KB
[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,7],[7,0]]
time 0.003804 s, REAL_BD 328.601472 GB/s, SIZE 16384.000000 KB, comm_vol 1310720.000000 KB
time 0.013908 s, REAL_BD 359.505321 GB/s, SIZE 65536.000000 KB, comm_vol 5242880.000000 KB
time 0.016508 s, REAL_BD 1211.533802 GB/s, SIZE 262144.000000 KB, comm_vol 20971520.000000 KB
time 0.051239 s, REAL_BD 1561.310720 GB/s, SIZE 1048576.000000 KB, comm_vol 83886080.000000 KB
+ set +x
BACKEND: MPI
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG -x NCCL_NET_GDR_LEVEL -x NCCL_DEBUG_SUBSYS -x NCCL_IB_DISABLE -np 8 --host g3017:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone 8 MPI ./scripts/configs/small_8.json
[g3017:1682291] MCW rank 0 bound to socket 0[core 0[hwt 0-1]]: [BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 1 bound to socket 0[core 1[hwt 0-1]]: [../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 2 bound to socket 0[core 2[hwt 0-1]]: [../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 3 bound to socket 0[core 3[hwt 0-1]]: [../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 4 bound to socket 1[core 32[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 5 bound to socket 1[core 33[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 6 bound to socket 1[core 34[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3017:1682291] MCW rank 7 bound to socket 1[core 35[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g3017
  Local device: mlx5_0
--------------------------------------------------------------------------
[[0,1]]
NCCL version 2.21.5+cuda11.8
time 0.000822 s, REAL_BD 190.085158 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.002941 s, REAL_BD 212.512751 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.009830 s, REAL_BD 254.323499 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.038352 s, REAL_BD 260.742595 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[0,1],[1,0]]
time 0.000947 s, REAL_BD 329.989440 GB/s, SIZE 16384.000000 KB, comm_vol 327680.000000 KB
time 0.002899 s, REAL_BD 431.183167 GB/s, SIZE 65536.000000 KB, comm_vol 1310720.000000 KB
time 0.010895 s, REAL_BD 458.926113 GB/s, SIZE 262144.000000 KB, comm_vol 5242880.000000 KB
time 0.042765 s, REAL_BD 467.672162 GB/s, SIZE 1048576.000000 KB, comm_vol 20971520.000000 KB
[[0,2]]
time 0.000805 s, REAL_BD 194.099379 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.002609 s, REAL_BD 239.555385 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.009780 s, REAL_BD 255.623722 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.038358 s, REAL_BD 260.701809 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[dmx-login03:166767] 7 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[dmx-login03:166767] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
[[0,2],[2,0]]
time 0.000860 s, REAL_BD 363.372093 GB/s, SIZE 16384.000000 KB, comm_vol 327680.000000 KB
time 0.002754 s, REAL_BD 453.885258 GB/s, SIZE 65536.000000 KB, comm_vol 1310720.000000 KB
time 0.010344 s, REAL_BD 483.372003 GB/s, SIZE 262144.000000 KB, comm_vol 5242880.000000 KB
time 0.040485 s, REAL_BD 494.010127 GB/s, SIZE 1048576.000000 KB, comm_vol 20971520.000000 KB
[[0,4]]
time 0.000812 s, REAL_BD 192.426108 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.002649 s, REAL_BD 235.938090 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.009808 s, REAL_BD 254.893964 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.038344 s, REAL_BD 260.796996 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[4,6]]
NCCL version 2.21.5+cuda11.8
time 0.000800 s, REAL_BD 195.312500 GB/s, SIZE 16384.000000 KB, comm_vol 163840.000000 KB
time 0.002590 s, REAL_BD 241.312741 GB/s, SIZE 65536.000000 KB, comm_vol 655360.000000 KB
time 0.009763 s, REAL_BD 256.068831 GB/s, SIZE 262144.000000 KB, comm_vol 2621440.000000 KB
time 0.038364 s, REAL_BD 260.661036 GB/s, SIZE 1048576.000000 KB, comm_vol 10485760.000000 KB
[[0,1],[1,2],[2,0]]
time 0.000871 s, REAL_BD 538.174512 GB/s, SIZE 16384.000000 KB, comm_vol 491520.000000 KB
time 0.002888 s, REAL_BD 649.238227 GB/s, SIZE 65536.000000 KB, comm_vol 1966080.000000 KB
time 0.010774 s, REAL_BD 696.120290 GB/s, SIZE 262144.000000 KB, comm_vol 7864320.000000 KB
time 0.042381 s, REAL_BD 707.864373 GB/s, SIZE 1048576.000000 KB, comm_vol 31457280.000000 KB
[[0,1],[1,2],[2,3],[3,0]]
time 0.000882 s, REAL_BD 708.616780 GB/s, SIZE 16384.000000 KB, comm_vol 655360.000000 KB
time 0.002890 s, REAL_BD 865.051903 GB/s, SIZE 65536.000000 KB, comm_vol 2621440.000000 KB
time 0.010841 s, REAL_BD 922.424131 GB/s, SIZE 262144.000000 KB, comm_vol 10485760.000000 KB
time 0.042635 s, REAL_BD 938.196318 GB/s, SIZE 1048576.000000 KB, comm_vol 41943040.000000 KB
[[0,1],[1,2],[2,3],[3,4],[4,5],[5,0]]
time 0.000952 s, REAL_BD 984.768908 GB/s, SIZE 16384.000000 KB, comm_vol 983040.000000 KB
time 0.003060 s, REAL_BD 1225.490196 GB/s, SIZE 65536.000000 KB, comm_vol 3932160.000000 KB
time 0.011062 s, REAL_BD 1355.993491 GB/s, SIZE 262144.000000 KB, comm_vol 15728640.000000 KB
time 0.042863 s, REAL_BD 1399.808693 GB/s, SIZE 1048576.000000 KB, comm_vol 62914560.000000 KB
[[0,1],[1,2],[2,3],[3,4],[4,5],[5,6],[6,7],[7,0]]
time 0.000957 s, REAL_BD 1306.165099 GB/s, SIZE 16384.000000 KB, comm_vol 1310720.000000 KB
time 0.003151 s, REAL_BD 1586.797842 GB/s, SIZE 65536.000000 KB, comm_vol 5242880.000000 KB
time 0.010962 s, REAL_BD 1824.484583 GB/s, SIZE 262144.000000 KB, comm_vol 20971520.000000 KB
time 0.042447 s, REAL_BD 1884.703277 GB/s, SIZE 1048576.000000 KB, comm_vol 83886080.000000 KB
+ set +x
