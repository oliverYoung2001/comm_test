make -C csrc clean
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
make -C csrc coll_comm_bench
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
nvcc coll_comm_bench.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o coll_comm_bench.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" coll_comm_bench.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib -L/data/apps/tools/spack/opt/spack/linux-ubuntu20.04-icelake/gcc-9.4.0/cuda-11.8.0-rqw2h4odyk5x2hyrawxblsmj5yxmka6e/bin/../lib64 -lcudart -lnccl -Wall -o build/coll_comm_bench -Wl,-rpath=/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o utils.o coll_comm_bench.o
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
./scripts/wrapper_coll_comm_bench_c.sh: line 45: BLE: command not found
BACKEND: NCCL
HOST: g4002,g4003
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -np 32 --host g4005:8,g4006:8,g4007:8,g4008:8 ./csrc/build/coll_comm_bench 32 NCCL
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g4007
  Local device: mlx5_0
--------------------------------------------------------------------------
[mngg001:3597186] 31 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:3597186] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
Comm_Op: ag
msg_size 16384.000000 KB, time 0.319438 s, tput 33.613466 GB/s, busbw 32.563045 GB/s
msg_size 65536.000000 KB, time 1.301016 s, tput 33.012410 GB/s, busbw 31.980772 GB/s
msg_size 262144.000000 KB, time 5.177843 s, tput 33.179587 GB/s, busbw 32.142725 GB/s
Comm_Op: rs
msg_size 16384.000000 KB, time 0.346647 s, tput 30.975079 GB/s, busbw 30.007108 GB/s
msg_size 65536.000000 KB, time 1.346066 s, tput 31.907554 GB/s, busbw 30.910442 GB/s
msg_size 262144.000000 KB, time 5.338213 s, tput 32.182809 GB/s, busbw 31.177097 GB/s
Comm_Op: ar
msg_size 16384.000000 KB, time 0.660743 s, tput 32.501043 GB/s, busbw 31.485385 GB/s
msg_size 65536.000000 KB, time 2.606616 s, tput 32.954354 GB/s, busbw 31.924530 GB/s
msg_size 262144.000000 KB, time 10.221527 s, tput 33.615074 GB/s, busbw 32.564603 GB/s
