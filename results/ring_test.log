SIZE: [1, 1024, 1024, 64]
time: 0.3854243755340576
BD: 12.97271350072715 GB/s
Traceback (most recent call last):
  File "ring_test.py", line 71, in <module>
    main()
  File "ring_test.py", line 68, in main
    torch.multiprocessing.spawn(net_test, nprocs=args.gpus, args=(args.gpus, args))
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 240, in spawn
    return start_processes(fn, args, nprocs, join, daemon, start_method='spawn')
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 198, in start_processes
    while not context.join():
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 160, in join
    raise ProcessRaisedException(msg, error_index, failed_process.pid)
torch.multiprocessing.spawn.ProcessRaisedException: 

-- Process 3 terminated with the following error:
Traceback (most recent call last):
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 69, in _wrap
    fn(i, *args)
  File "/home/yhy/fold/test/ring_test.py", line 61, in net_test
    del a, b
UnboundLocalError: local variable 'a' referenced before assignment

Traceback (most recent call last):
  File "ring_test.py", line 71, in <module>
    main()
  File "ring_test.py", line 68, in main
    torch.multiprocessing.spawn(net_test, nprocs=args.gpus, args=(args.gpus, args))
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 240, in spawn
    return start_processes(fn, args, nprocs, join, daemon, start_method='spawn')
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 198, in start_processes
    while not context.join():
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 160, in join
    raise ProcessRaisedException(msg, error_index, failed_process.pid)
torch.multiprocessing.spawn.ProcessRaisedException: 

-- Process 3 terminated with the following error:
Traceback (most recent call last):
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 69, in _wrap
    fn(i, *args)
  File "/home/yhy/fold/test/ring_test.py", line 41, in net_test
    recv_buf = torch.empty(SIZE, dtype=torch.float32).cuda()
RuntimeError: CUDA out of memory. Tried to allocate 16.00 GiB (GPU 3; 39.42 GiB total capacity; 32.00 GiB already allocated; 6.53 GiB free; 32.00 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

SIZE: [1, 1024, 1024, 64]
time: 0.3883986473083496
BD: 12.87337130201306 GB/s
SIZE: [1, 1024, 1024, 128]
time: 0.5734467506408691
BD: 17.43841078325801 GB/s
SIZE: [1, 1024, 1024, 256]
time: 1.1469824314117432
BD: 17.437058713605012 GB/s
SIZE: [1, 1024, 1024, 512]
time: 2.2978575229644775
BD: 17.40751965700458 GB/s
SIZE: [1, 1024, 1024, 1024]
time: 4.598904132843018
BD: 17.395448500150497 GB/s
SIZE: [1, 1024, 1024, 2048]
time: 9.194199562072754
BD: 17.402276176386295 GB/s
SIZE: [1, 1024, 1024, 4096]
Traceback (most recent call last):
  File "ring_test.py", line 72, in <module>
    main()
  File "ring_test.py", line 69, in main
    torch.multiprocessing.spawn(net_test, nprocs=args.gpus, args=(args.gpus, args))
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 240, in spawn
    return start_processes(fn, args, nprocs, join, daemon, start_method='spawn')
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 198, in start_processes
    while not context.join():
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 160, in join
    raise ProcessRaisedException(msg, error_index, failed_process.pid)
torch.multiprocessing.spawn.ProcessRaisedException: 

-- Process 0 terminated with the following error:
Traceback (most recent call last):
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 69, in _wrap
    fn(i, *args)
  File "/home/yhy/fold/test/ring_test.py", line 41, in net_test
    recv_buf = torch.empty(SIZE, dtype=torch.float32).cuda()
RuntimeError: CUDA out of memory. Tried to allocate 16.00 GiB (GPU 0; 39.42 GiB total capacity; 32.00 GiB already allocated; 6.51 GiB free; 32.00 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

SIZE: [1, 1024, 1024, 64]
time: 0.9582531452178955
BD: 15.653483711330972 GB/s
SIZE: [1, 1024, 1024, 128]
time: 1.7234218120574951
BD: 17.407230075720527 GB/s
SIZE: [1, 1024, 1024, 256]
time: 3.4492762088775635
BD: 17.394953713934303 GB/s
SIZE: [1, 1024, 1024, 512]
time: 6.91275429725647
BD: 17.359216723155566 GB/s
SIZE: [1, 1024, 1024, 1024]
time: 13.837052822113037
BD: 17.34473396072141 GB/s
SIZE: [1, 1024, 1024, 2048]
time: 27.66741704940796
BD: 17.34892704811674 GB/s
SIZE: [1, 1024, 1024, 4096]
Traceback (most recent call last):
  File "ring_test.py", line 73, in <module>
    main()
  File "ring_test.py", line 70, in main
    torch.multiprocessing.spawn(net_test, nprocs=args.gpus, args=(args.gpus, args))
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 240, in spawn
    return start_processes(fn, args, nprocs, join, daemon, start_method='spawn')
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 198, in start_processes
    while not context.join():
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 160, in join
    raise ProcessRaisedException(msg, error_index, failed_process.pid)
torch.multiprocessing.spawn.ProcessRaisedException: 

-- Process 2 terminated with the following error:
Traceback (most recent call last):
  File "/home/yhy/.local/miniconda3/envs/fastfold/lib/python3.8/site-packages/torch/multiprocessing/spawn.py", line 69, in _wrap
    fn(i, *args)
  File "/home/yhy/fold/test/ring_test.py", line 41, in net_test
    recv_buf = torch.empty(SIZE, dtype=torch.float32).cuda()
RuntimeError: CUDA out of memory. Tried to allocate 16.00 GiB (GPU 2; 39.42 GiB total capacity; 32.00 GiB already allocated; 6.51 GiB free; 32.00 GiB reserved in total by PyTorch) If reserved memory is >> allocated memory try setting max_split_size_mb to avoid fragmentation.  See documentation for Memory Management and PYTORCH_CUDA_ALLOC_CONF

SIZE: [1, 1024, 1024, 64]
time: 0.9481289386749268
BD: 15.820633025887279 GB/s
SIZE: [1, 1024, 1024, 128]
time: 1.7264771461486816
BD: 17.376424626831664 GB/s
SIZE: [1, 1024, 1024, 256]
time: 3.452061414718628
BD: 17.380919048594187 GB/s
SIZE: [1, 1024, 1024, 512]
time: 6.919169902801514
BD: 17.343120878042466 GB/s
SIZE: [1, 1024, 1024, 1024]
time: 13.848169803619385
BD: 17.33081002063342 GB/s
SIZE: [1, 1024, 1024, 2048]
time: 27.69350504875183
BD: 17.332583909295874 GB/s
SIZE: [1, 1024, 1024, 64]
time: 0.9524798393249512
BD: 15.74836482694575 GB/s
SIZE: [1, 1024, 1024, 128]
time: 1.7189748287200928
BD: 17.452262533906488 GB/s
SIZE: [1, 1024, 1024, 256]
time: 3.435175895690918
BD: 17.466354510481967 GB/s
SIZE: [1, 1024, 1024, 512]
time: 6.885497808456421
BD: 17.42793380205888 GB/s
SIZE: [1, 1024, 1024, 1024]
time: 13.779475212097168
BD: 17.41720902326535 GB/s
SIZE: [1, 1024, 1024, 2048]
time: 27.55361557006836
BD: 17.42058129465327 GB/s
