make -C csrc clean
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
ls: cannot access '*.o': No such file or directory
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
make -C csrc conflict_allinone
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
nvcc conflict_allinone.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o conflict_allinone.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" conflict_allinone.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib -L/data/apps/tools/spack/opt/spack/linux-ubuntu20.04-icelake/gcc-9.4.0/cuda-11.8.0-rqw2h4odyk5x2hyrawxblsmj5yxmka6e/bin/../lib64 -lcudart -lnccl -Wall -o build/conflict_allinone -Wl,-rpath=/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o utils.o conflict_allinone.o
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
BACKEND: MPI
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi-cuda-ucx-gdrcopy/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi-cuda-ucx-gdrcopy/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG -x NCCL_NET_GDR_LEVEL -x NCCL_DEBUG_SUBSYS -x NCCL_IB_DISABLE -np 16 --host g3021:8,g3022:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone 16 MPI ./scripts/configs/small_16.json
[g3021:323951] MCW rank 0 bound to socket 0[core 0[hwt 0-1]]: [BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 1 bound to socket 0[core 1[hwt 0-1]]: [../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 2 bound to socket 0[core 2[hwt 0-1]]: [../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 3 bound to socket 0[core 3[hwt 0-1]]: [../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 4 bound to socket 1[core 32[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 5 bound to socket 1[core 33[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 6 bound to socket 1[core 34[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3021:323951] MCW rank 7 bound to socket 1[core 35[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 9 bound to socket 0[core 1[hwt 0-1]]: [../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 10 bound to socket 0[core 2[hwt 0-1]]: [../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 11 bound to socket 0[core 3[hwt 0-1]]: [../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 12 bound to socket 1[core 32[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 13 bound to socket 1[core 33[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 14 bound to socket 1[core 34[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 15 bound to socket 1[core 35[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g3022:3672352] MCW rank 8 bound to socket 0[core 0[hwt 0-1]]: [BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g3022
  Local device: mlx5_0
--------------------------------------------------------------------------
[[0,1]]
[mngg001:1317540] 15 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:1317540] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
NCCL version 2.18.5+cuda11.8
time 0.019305 s, REAL_BD 259.000259 GB/s, SIZE 524288.000000 KB, comm_vol 5242880.000000 KB
time 0.076696 s, REAL_BD 260.769792 GB/s, SIZE 2097152.000000 KB, comm_vol 20971520.000000 KB
[[0,1],[1,0]]
time 0.021419 s, REAL_BD 466.875204 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 0.080830 s, REAL_BD 494.865768 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,8]]
time 0.291362 s, REAL_BD 17.160783 GB/s, SIZE 524288.000000 KB, comm_vol 5242880.000000 KB
time 1.199342 s, REAL_BD 16.675811 GB/s, SIZE 2097152.000000 KB, comm_vol 20971520.000000 KB
[[0,8],[8,0]]
time 0.310075 s, REAL_BD 32.250262 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 1.284868 s, REAL_BD 31.131603 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,15],[15,0]]
time 0.320891 s, REAL_BD 31.163230 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 2.168114 s, REAL_BD 18.449214 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,8],[0,15]]
time 0.425077 s, REAL_BD 23.525150 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 2.544487 s, REAL_BD 15.720261 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,8],[0,15],[8,0],[15,0]]
time 0.449702 s, REAL_BD 44.473896 GB/s, SIZE 524288.000000 KB, comm_vol 20971520.000000 KB
time 2.558619 s, REAL_BD 31.266867 GB/s, SIZE 2097152.000000 KB, comm_vol 83886080.000000 KB
[[7,8],[15,0]]
time 0.288010 s, REAL_BD 34.721017 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 2.017047 s, REAL_BD 19.830971 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,8],[2,10]]
time 0.269327 s, REAL_BD 37.129586 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 1.207627 s, REAL_BD 33.122810 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,8],[8,0],[2,10],[10,2]]
time 0.340210 s, REAL_BD 58.787220 GB/s, SIZE 524288.000000 KB, comm_vol 20971520.000000 KB
time 1.342858 s, REAL_BD 59.574430 GB/s, SIZE 2097152.000000 KB, comm_vol 83886080.000000 KB
[[0,8],[4,12]]
time 0.305168 s, REAL_BD 32.768836 GB/s, SIZE 524288.000000 KB, comm_vol 10485760.000000 KB
time 1.206025 s, REAL_BD 33.166808 GB/s, SIZE 2097152.000000 KB, comm_vol 41943040.000000 KB
[[0,8],[8,0],[4,12],[12,4]]
time 0.324505 s, REAL_BD 61.632332 GB/s, SIZE 524288.000000 KB, comm_vol 20971520.000000 KB
time 1.345932 s, REAL_BD 59.438367 GB/s, SIZE 2097152.000000 KB, comm_vol 83886080.000000 KB
[[0,8],[2,10],[4,12],[6,14]]
time 0.292049 s, REAL_BD 68.481659 GB/s, SIZE 524288.000000 KB, comm_vol 20971520.000000 KB
time 1.211779 s, REAL_BD 66.018639 GB/s, SIZE 2097152.000000 KB, comm_vol 83886080.000000 KB
[[0,8],[8,0],[2,10],[10,2],[4,12],[12,4],[6,14],[14,6]]
time 0.343997 s, REAL_BD 116.280084 GB/s, SIZE 524288.000000 KB, comm_vol 41943040.000000 KB
time 1.333509 s, REAL_BD 119.984192 GB/s, SIZE 2097152.000000 KB, comm_vol 167772160.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15]]
time 0.605354 s, REAL_BD 66.077039 GB/s, SIZE 524288.000000 KB, comm_vol 41943040.000000 KB
time 2.320867 s, REAL_BD 68.939754 GB/s, SIZE 2097152.000000 KB, comm_vol 167772160.000000 KB
[[0,8],[1,9],[2,10],[3,11],[4,12],[5,13],[6,14],[7,15],[8,0],[9,1],[10,2],[11,3],[12,4],[13,5],[14,6],[15,7]]
time 0.637525 s, REAL_BD 125.485275 GB/s, SIZE 524288.000000 KB, comm_vol 83886080.000000 KB
time 2.536918 s, REAL_BD 126.137305 GB/s, SIZE 2097152.000000 KB, comm_vol 335544320.000000 KB
+ set +x
