make -C csrc clean
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
ls: cannot access '*.o': No such file or directory
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
make -C csrc conflict_allinone
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
nvcc conflict_allinone.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o conflict_allinone.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" conflict_allinone.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib -L/data/apps/tools/spack/opt/spack/linux-ubuntu20.04-icelake/gcc-9.4.0/cuda-11.8.0-rqw2h4odyk5x2hyrawxblsmj5yxmka6e/bin/../lib64 -lcudart -lnccl -Wall -o build/conflict_allinone -Wl,-rpath=/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o utils.o conflict_allinone.o
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
BACKEND: NCCL
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi-cuda-ucx-gdrcopy/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi-cuda-ucx-gdrcopy/bin/../ -x LD_LIBRARY_PATH -x NCCL_NET_GDR_READ -x NCCL_P2P_LEVEL -x NCCL_IB_PCI_RELAXED_ORDERING -x NCCL_DEBUG=WARN -x NCCL_IB_GID_INDEX=3 -x NCCL_IB_DISABLE=0 -x NCCL_NET_GDR_LEVEL=2 -x NCCL_IB_QPS_PER_CONNECTION=4 -x NCCL_IB_TC=160 -np 8 --host g4006:8 ./csrc/build/conflict_allinone 8 NCCL ./scripts/configs/small_8.json
[mngg001:3252180] Warning: could not find environment variable "NCCL_NET_GDR_READ"
[mngg001:3252180] Warning: could not find environment variable "NCCL_P2P_LEVEL"
[mngg001:3252180] Warning: could not find environment variable "NCCL_IB_PCI_RELAXED_ORDERING"
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g4006
  Local device: mlx5_0
--------------------------------------------------------------------------
NCCL version 2.18.5+cuda11.8
[mngg001:3252180] 7 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:3252180] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
[[0,1]]
time 0.006833 s, REAL_BD 219.522904 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.025734 s, REAL_BD 233.154581 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,1],[1,0]]
time 0.007297 s, REAL_BD 411.127861 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.027559 s, REAL_BD 435.429442 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
+ set +x
BACKEND: MPI
CP_FILE_NAME: small
NNODES: 2
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi-cuda-ucx-gdrcopy/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi-cuda-ucx-gdrcopy/bin/../ -x LD_LIBRARY_PATH -x NCCL_NET_GDR_READ -x NCCL_P2P_LEVEL -x NCCL_IB_PCI_RELAXED_ORDERING -x NCCL_DEBUG=WARN -x NCCL_IB_GID_INDEX=3 -x NCCL_IB_DISABLE=0 -x NCCL_NET_GDR_LEVEL=2 -x NCCL_IB_QPS_PER_CONNECTION=4 -x NCCL_IB_TC=160 -np 8 --host g4006:8 ./csrc/build/conflict_allinone 8 MPI ./scripts/configs/small_8.json
[mngg001:3272898] Warning: could not find environment variable "NCCL_NET_GDR_READ"
[mngg001:3272898] Warning: could not find environment variable "NCCL_P2P_LEVEL"
[mngg001:3272898] Warning: could not find environment variable "NCCL_IB_PCI_RELAXED_ORDERING"
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g4006
  Local device: mlx5_0
--------------------------------------------------------------------------
[[0,1]]
NCCL version 2.18.5+cuda11.8
time 0.005789 s, REAL_BD 259.112109 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
time 0.022903 s, REAL_BD 261.974414 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[[0,1],[1,0]]
time 0.006118 s, REAL_BD 490.356326 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.024236 s, REAL_BD 495.131210 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[mngg001:3272898] 7 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:3272898] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
+ set +x
