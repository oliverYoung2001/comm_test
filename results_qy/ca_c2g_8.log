make -C csrc clean
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
rm -f `ls *.o | grep -v jsoncpp.o`
ls: cannot access '*.o': No such file or directory
rm -f all2all_test net_test net_test_cuda conflict_test_cuda net_test_mpi conflict_allinone net_test_cpu nccl_test cpu2gpu \
   benchmark_p2p ring_patterns all2all_baseline single_turn mixed_p2p netflow all2allv_MPI all2allv_allinone
rm -rf build
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
make -C csrc conflict_allinone_c2g
make[1]: Entering directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
nvcc conflict_allinone_c2g.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o conflict_allinone_c2g.o
nvcc comm.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o comm.o
gcc jsoncpp.cpp -std=c++11 -c -o jsoncpp.o
nvcc utils.cu -std=c++11 -Xcompiler -fopenmp -I/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/include -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib/ "-gencode=arch=compute_80,code=sm_80" -lnccl -lcudart -c -o utils.o
mkdir -p build
"`which mpicxx`" conflict_allinone_c2g.o comm.o jsoncpp.o utils.o -no-pie -std=c++11 -fopenmp -L/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib -L/data/apps/tools/spack/opt/spack/linux-ubuntu20.04-icelake/gcc-9.4.0/cuda-11.8.0-rqw2h4odyk5x2hyrawxblsmj5yxmka6e/bin/../lib64 -lcudart -lnccl -Wall -o build/conflict_allinone_c2g -Wl,-rpath=/home/zhaijidong/yhy/llm/comm_test/third_party/nccl/build/lib
rm jsoncpp.o comm.o conflict_allinone_c2g.o utils.o
make[1]: Leaving directory '/home/zhaijidong/yhy/llm/comm_test/csrc'
BACKEND: MPI
CP_FILE_NAME: c2g
DIR_NUM: 1
NNODES: 1
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG=WARN -np 8 --host g4008:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone_c2g 8 MPI ./scripts/configs/c2g_8.json 1
[g4008:13368] MCW rank 1 bound to socket 0[core 1[hwt 0-1]]: [../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 2 bound to socket 0[core 2[hwt 0-1]]: [../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 3 bound to socket 0[core 3[hwt 0-1]]: [../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 4 bound to socket 1[core 32[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 5 bound to socket 1[core 33[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 6 bound to socket 1[core 34[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 7 bound to socket 1[core 35[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:13368] MCW rank 0 bound to socket 0[core 0[hwt 0-1]]: [BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g4008
  Local device: mlx5_0
--------------------------------------------------------------------------
[0]
time 0.000789 s, REAL_BD 3.713165 GB/s, SIZE 1024.000000 KB, comm_vol 3072.000000 KB
time 0.040170 s, REAL_BD 9.335325 GB/s, SIZE 131072.000000 KB, comm_vol 393216.000000 KB
time 0.159630 s, REAL_BD 9.396730 GB/s, SIZE 524288.000000 KB, comm_vol 1572864.000000 KB
[mngg001:814065] 7 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:814065] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
time 0.638210 s, REAL_BD 9.401294 GB/s, SIZE 2097152.000000 KB, comm_vol 6291456.000000 KB
[0,1]
time 0.000471 s, REAL_BD 12.440287 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.040194 s, REAL_BD 18.659501 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.159704 s, REAL_BD 18.784752 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.638578 s, REAL_BD 18.791753 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[0,4]
time 0.000793 s, REAL_BD 7.388871 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.039998 s, REAL_BD 18.750938 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.159511 s, REAL_BD 18.807480 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
time 0.638542 s, REAL_BD 18.792812 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[0,1,2,3]
time 0.000882 s, REAL_BD 13.286565 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.040257 s, REAL_BD 37.260601 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.160190 s, REAL_BD 37.455522 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.727508 s, REAL_BD 32.989328 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[0,2,4,6]
time 0.000797 s, REAL_BD 14.703576 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.040043 s, REAL_BD 37.459731 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.159833 s, REAL_BD 37.539182 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.730408 s, REAL_BD 32.858348 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[0,1,2,3,4,5,6,7]
time 0.000907 s, REAL_BD 25.840684 GB/s, SIZE 1024.000000 KB, comm_vol 24576.000000 KB
time 0.040237 s, REAL_BD 74.558242 GB/s, SIZE 131072.000000 KB, comm_vol 3145728.000000 KB
time 0.159882 s, REAL_BD 75.055353 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 0.728240 s, REAL_BD 65.912337 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
+ set +x
DIR_NUM: 2
NNODES: 1
NGPU_PER_NODE: 8
+++ which mpirun
++ dirname /home/zhaijidong/yhy/.local/openmpi/bin/mpirun
+ mpirun --prefix /home/zhaijidong/yhy/.local/openmpi/bin/../ -x LD_LIBRARY_PATH -x NCCL_DEBUG=WARN -np 8 --host g4008:8 --map-by ppr:4:numa --bind-to core --report-bindings ./csrc/build/conflict_allinone_c2g 8 MPI ./scripts/configs/c2g_8.json 2
[g4008:14110] MCW rank 0 bound to socket 0[core 0[hwt 0-1]]: [BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 1 bound to socket 0[core 1[hwt 0-1]]: [../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 2 bound to socket 0[core 2[hwt 0-1]]: [../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 3 bound to socket 0[core 3[hwt 0-1]]: [../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 4 bound to socket 1[core 32[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 5 bound to socket 1[core 33[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 6 bound to socket 1[core 34[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
[g4008:14110] MCW rank 7 bound to socket 1[core 35[hwt 0-1]]: [../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../../..][../../../BB/../../../../../../../../../../../../../../../../../../../../../../../../../../../..]
--------------------------------------------------------------------------
WARNING: There was an error initializing an OpenFabrics device.

  Local host:   g4008
  Local device: mlx5_0
--------------------------------------------------------------------------
[0]
time 0.000815 s, REAL_BD 7.189417 GB/s, SIZE 1024.000000 KB, comm_vol 6144.000000 KB
time 0.058522 s, REAL_BD 12.815693 GB/s, SIZE 131072.000000 KB, comm_vol 786432.000000 KB
time 0.232152 s, REAL_BD 12.922568 GB/s, SIZE 524288.000000 KB, comm_vol 3145728.000000 KB
[mngg001:817769] 7 more processes have sent help message help-mpi-btl-openib.txt / error in device init
[mngg001:817769] Set MCA parameter "orte_base_help_aggregate" to 0 to see all help / error messages
time 0.928084 s, REAL_BD 12.929864 GB/s, SIZE 2097152.000000 KB, comm_vol 12582912.000000 KB
[0,1]
time 0.003294 s, REAL_BD 3.557605 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.073175 s, REAL_BD 20.498804 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.291665 s, REAL_BD 20.571546 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 1.165762 s, REAL_BD 20.587393 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[0,4]
time 0.003306 s, REAL_BD 3.544691 GB/s, SIZE 1024.000000 KB, comm_vol 12288.000000 KB
time 0.058265 s, REAL_BD 25.744443 GB/s, SIZE 131072.000000 KB, comm_vol 1572864.000000 KB
time 0.232065 s, REAL_BD 25.854825 GB/s, SIZE 524288.000000 KB, comm_vol 6291456.000000 KB
time 0.927180 s, REAL_BD 25.884941 GB/s, SIZE 2097152.000000 KB, comm_vol 25165824.000000 KB
[0,1,2,3]
time 0.003517 s, REAL_BD 6.664060 GB/s, SIZE 1024.000000 KB, comm_vol 24576.000000 KB
time 0.074065 s, REAL_BD 40.504962 GB/s, SIZE 131072.000000 KB, comm_vol 3145728.000000 KB
time 0.295352 s, REAL_BD 40.629486 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 1.180628 s, REAL_BD 40.656329 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[0,2,4,6]
time 0.003299 s, REAL_BD 7.104426 GB/s, SIZE 1024.000000 KB, comm_vol 24576.000000 KB
time 0.066426 s, REAL_BD 45.163039 GB/s, SIZE 131072.000000 KB, comm_vol 3145728.000000 KB
time 0.232773 s, REAL_BD 51.552371 GB/s, SIZE 524288.000000 KB, comm_vol 12582912.000000 KB
time 0.933646 s, REAL_BD 51.411349 GB/s, SIZE 2097152.000000 KB, comm_vol 50331648.000000 KB
[0,1,2,3,4,5,6,7]
time 0.003300 s, REAL_BD 14.204545 GB/s, SIZE 1024.000000 KB, comm_vol 49152.000000 KB
time 0.074166 s, REAL_BD 80.899604 GB/s, SIZE 131072.000000 KB, comm_vol 6291456.000000 KB
time 0.295545 s, REAL_BD 81.205908 GB/s, SIZE 524288.000000 KB, comm_vol 25165824.000000 KB
time 1.190572 s, REAL_BD 80.633511 GB/s, SIZE 2097152.000000 KB, comm_vol 100663296.000000 KB
+ set +x
